<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <title>Login</title>
    <link rel="stylesheet" href="style.css">
    <style>
        
    </style>
</head>
<body>
    <div id="loginStatus" class="loginStatus">
        <span id="loginName"></span>
        <a href="" id="logout" class="logout">ログアウト</a>
    </div>
    <ul id="errors" class="errors">
        
    </ul>
    <form action="" id="login-form">
        <div><label for="user_id">User ID</label><input type="email" name="user_id" id="user_id"></div>
        <div><label for="password">Password</label><input type="password" name="password" id="password"></div>
        <div><input type="submit" value="ログイン"></div>
    </form>

    <section id="like-content" class="like-content">
        <div id="like1" class="like-box">
            <a class="btn disabled" href="">いいね<span class="count"></span></a>
        </div>
        <div id="like2" class="like-box">
            <a class="btn disabled" href="">いいね<span class="count"></span></a>
        </div>
        <div id="like3" class="like-box">
            <a class="btn disabled" href="">いいね<span class="count"></span></a>
        </div>
    </section>


<!-- スクリプト -->
<script src="/__/firebase/5.8.2/firebase.js"></script>

<!-- Firebase App is always required and must be first -->
<script src="/__/firebase/5.8.2/firebase-app.js"></script>

<!-- Add additional services that you want to use -->
<script src="/__/firebase/5.8.2/firebase-auth.js"></script>
<script src="/__/firebase/5.8.2/firebase-database.js"></script>
<script src="/__/firebase/5.8.2/firebase-firestore.js"></script>
<script src="/__/firebase/5.8.2/firebase-messaging.js"></script>
<script src="/__/firebase/5.8.2/firebase-functions.js"></script>

<!-- load Firebase SDK before loading this file -->
<script src="/__/firebase/init.js"></script>

<script>

    // 送信時の処理
    var el = document.getElementById('login-form');
    var errors = document.getElementById('errors');

    // ログイン処理
    el.addEventListener('submit', function(event){
        var user_id = el.user_id.value;
        var password = el.password.value;
        while(errors.firstChild) errors.removeChild(errors.firstChild);

        firebase.auth().signInWithEmailAndPassword(user_id, password).catch(function(error) {
            // ログインエラー
            var errorCode = error.code;
            var errorMessage = error.message;
            var errorItem = document.createElement('li');
            errorItem.textContent = errorMessage;
            errors.appendChild( errorItem );
        });

        // イベントキャンセル
        event.preventDefault();
    });

    // ログアウト処理
    document.getElementById('logout').addEventListener('click', function(event){
        firebase.auth().signOut();
    });

    // ログイン時の処理
    firebase.auth().onAuthStateChanged( function( user ) {
        while ( errors.firstChild ) errors.removeChild( errors.firstChild );
        var btnList = document.getElementsByClassName( 'btn' );
        if ( user ) {
            // ボタンをアクティブにする
            console.log( 'user login ' + user.email );
            for(var i = 0; i < btnList.length; i++){
                btnList[i].classList.remove( 'disabled' );
            }

            // ログイン状態の表示
            document.getElementById('loginStatus').style.display = 'block';
            document.getElementById('loginName').textContent = user.email + 'でログイン中';

        } else {
            // ボタンを無効にする
            console.log('logout')
            for(var i = 0; i < btnList.length; i++){
                btnList[i].classList.add( 'disabled' );
            }
            // ログイン状態を隠す
            document.getElementById('loginStatus').style.display = 'none';
        }
    });
</script>
</body>
</html>